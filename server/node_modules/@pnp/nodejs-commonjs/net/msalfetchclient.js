"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MsalFetchClient = void 0;
var msal_node_1 = require("@azure/msal-node");
var common_1 = require("@pnp/common-commonjs");
var fetch_js_1 = require("./fetch.js");
var MsalFetchClient = /** @class */ (function () {
    function MsalFetchClient(_config, _scopes) {
        if (_scopes === void 0) { _scopes = ["https://graph.microsoft.com/.default"]; }
        this._scopes = _scopes;
        this.confidentialClient = new msal_node_1.ConfidentialClientApplication(_config);
    }
    MsalFetchClient.prototype.fetch = function (url, options) {
        if (!(0, common_1.objectDefinedNotNull)(options)) {
            options = {
                headers: new Headers(),
            };
        }
        else if (!(0, common_1.objectDefinedNotNull)(options.headers)) {
            options = (0, common_1.assign)(options, {
                headers: new Headers(),
            });
        }
        return this.acquireToken().then(function (token) {
            options.headers.set("Authorization", token.tokenType + " " + token.accessToken);
            return (0, fetch_js_1.fetch)(url, options);
        });
    };
    MsalFetchClient.prototype.acquireToken = function (scopes) {
        if (scopes === void 0) { scopes = this._scopes; }
        return this.confidentialClient.acquireTokenByClientCredential({ scopes: scopes });
    };
    return MsalFetchClient;
}());
exports.MsalFetchClient = MsalFetchClient;
//# sourceMappingURL=msalfetchclient.js.map